[
  {
    "id": "model_api",
    "title": "Generated API Handler",
    "path": "app/service-core/transport/skeleton/route.go",
    "lang": "go",
    "description": "Type-safe RPC handlers automatically generated for your data model.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">package</span><span style=\"color:#B392F0\"> skeleton</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> (</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">context</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">errors</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">fmt</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tproto </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">gofast/gen/proto/v1</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/pkg</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/service-core/domain/skeleton</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/service-core/storage/query</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">time</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">connectrpc.com/connect</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">github.com/google/uuid</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> Server</span><span style=\"color:#F97583\"> struct</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tdeps </span><span style=\"color:#B392F0\">skeleton</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Deps</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> NewSkeletonServer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">deps</span><span style=\"color:#B392F0\"> skeleton</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">{deps: deps}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> queryToProto</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">skeleton</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tId:      skeleton.ID.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCreated: skeleton.Created.</span><span style=\"color:#B392F0\">Format</span><span style=\"color:#E1E4E8\">(time.RFC3339),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tUpdated: skeleton.Updated.</span><span style=\"color:#B392F0\">Format</span><span style=\"color:#E1E4E8\">(time.RFC3339),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tName:    skeleton.Name,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tAge:     skeleton.Age,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tDeath:   skeleton.Death.</span><span style=\"color:#B392F0\">Format</span><span style=\"color:#E1E4E8\">(time.RFC3339),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tZombie:  skeleton.Zombie,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">GetAllSkeletons</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\t_</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Request</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetAllSkeletonsRequest</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tstream</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ServerStream</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetAllSkeletonsResponse</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> s.</span><span style=\"color:#B392F0\">GetAllSkeletonsLogic</span><span style=\"color:#E1E4E8\">(ctx, stream.Send)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">GetAllSkeletonsLogic</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">send</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetAllSkeletonsResponse</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tprocessor </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">_</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">skel</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> ctx.</span><span style=\"color:#B392F0\">Err</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: ctx.</span><span style=\"color:#B392F0\">Err</span><span style=\"color:#E1E4E8\">()}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetAllSkeletonsResponse</span><span style=\"color:#E1E4E8\">{Skeleton: </span><span style=\"color:#B392F0\">queryToProto</span><span style=\"color:#E1E4E8\">(skel)})</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\terr </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> skeleton.</span><span style=\"color:#B392F0\">GetAllSkeletons</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s.deps, processor)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"error getting all skeletons: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">GetSkeletonByID</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\treq</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Request</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetSkeletonByIDRequest</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Response</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetSkeletonByIDResponse</span><span style=\"color:#E1E4E8\">], </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tid, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> uuid.</span><span style=\"color:#B392F0\">Parse</span><span style=\"color:#E1E4E8\">(req.Msg.</span><span style=\"color:#B392F0\">GetId</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">BadRequestError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tskel, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> skeleton.</span><span style=\"color:#B392F0\">GetSkeletonByID</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s.deps, id)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"error getting skeleton by id: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> connect.</span><span style=\"color:#B392F0\">NewResponse</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">GetSkeletonByIDResponse</span><span style=\"color:#E1E4E8\">{Skeleton: </span><span style=\"color:#B392F0\">queryToProto</span><span style=\"color:#E1E4E8\">(skel)}), </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">CreateSkeleton</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\treq</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Request</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CreateSkeletonRequest</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Response</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CreateSkeletonResponse</span><span style=\"color:#E1E4E8\">], </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> req.Msg.</span><span style=\"color:#B392F0\">GetSkeleton</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">==</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">BadRequestError</span><span style=\"color:#E1E4E8\">{Err: errors.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"skeleton is nil\"</span><span style=\"color:#E1E4E8\">)}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tcreated, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> skeleton.</span><span style=\"color:#B392F0\">CreateSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s.deps, req.Msg)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"error creating skeleton: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> connect.</span><span style=\"color:#B392F0\">NewResponse</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CreateSkeletonResponse</span><span style=\"color:#E1E4E8\">{Skeleton: </span><span style=\"color:#B392F0\">queryToProto</span><span style=\"color:#E1E4E8\">(created)}), </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">EditSkeleton</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\treq</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Request</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">EditSkeletonRequest</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Response</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">EditSkeletonResponse</span><span style=\"color:#E1E4E8\">], </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> req.Msg.</span><span style=\"color:#B392F0\">GetSkeleton</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">==</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">BadRequestError</span><span style=\"color:#E1E4E8\">{Err: errors.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"skeleton is nil\"</span><span style=\"color:#E1E4E8\">)}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tedited, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> skeleton.</span><span style=\"color:#B392F0\">EditSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s.deps, req.Msg)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"error editing skeleton: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> connect.</span><span style=\"color:#B392F0\">NewResponse</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">EditSkeletonResponse</span><span style=\"color:#E1E4E8\">{Skeleton: </span><span style=\"color:#B392F0\">queryToProto</span><span style=\"color:#E1E4E8\">(edited)}), </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">s </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">Server</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#B392F0\">RemoveSkeleton</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\tctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">\treq</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Request</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">RemoveSkeletonRequest</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">connect</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Response</span><span style=\"color:#E1E4E8\">[</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">RemoveSkeletonResponse</span><span style=\"color:#E1E4E8\">], </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tid, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> uuid.</span><span style=\"color:#B392F0\">Parse</span><span style=\"color:#E1E4E8\">(req.Msg.</span><span style=\"color:#B392F0\">GetId</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">BadRequestError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> skeleton.</span><span style=\"color:#B392F0\">RemoveSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s.deps, id)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"error removing skeleton: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> connect.</span><span style=\"color:#B392F0\">NewResponse</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">RemoveSkeletonResponse</span><span style=\"color:#E1E4E8\">{}), </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>"
  },
  {
    "id": "model_service",
    "title": "Generated Service",
    "path": "app/service-core/domain/skeleton/service.go",
    "lang": "go",
    "description": "Clean business logic layer with validation, auth, and tracing hooks.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">package</span><span style=\"color:#B392F0\"> skeleton</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> (</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">context</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">fmt</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/pkg</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/pkg/auth</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tot </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">gofast/pkg/otel</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/service-core/storage/query</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tproto </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">gofast/gen/proto/v1</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">github.com/google/uuid</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> Deps</span><span style=\"color:#F97583\"> struct</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tStore </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Queries</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> GetAllSkeletons</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">processor</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">user</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"skeleton.service.GetAllSkeletons\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.GetSkeletons)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tskeletons, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">SelectAllSkeletons</span><span style=\"color:#E1E4E8\">(ctx, claims.ID)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">NotFoundError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Skeletons selected from store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tfor</span><span style=\"color:#E1E4E8\"> _, s </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> range</span><span style=\"color:#E1E4E8\"> skeletons {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> processor</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">s)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> GetSkeletonByID</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">id</span><span style=\"color:#B392F0\"> uuid</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">UUID</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">result</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"skeleton.service.GetSkeletonByID\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.GetSkeletons)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tskeleton, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">SelectSkeletonByID</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">SelectSkeletonByIDParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tID:     id,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tUserID: claims.ID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t})</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">NotFoundError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Skeleton selected from store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\">skeleton, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> CreateSkeleton</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CreateSkeletonRequest</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">result</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"skeleton.service.CreateSkeleton\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.CreateSkeleton)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tparams, validation </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> ValidateAndBuildInsertParams</span><span style=\"color:#E1E4E8\">(claims.ID, req.</span><span style=\"color:#B392F0\">GetSkeleton</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> validation </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"validation errors: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, pkg.</span><span style=\"color:#B392F0\">ValidationErrors</span><span style=\"color:#E1E4E8\">(validation))</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Validation successful\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tskeleton, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">InsertSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">*</span><span style=\"color:#E1E4E8\">params)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Skeleton inserted into store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\">skeleton, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> EditSkeleton</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">req</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">proto</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">EditSkeletonRequest</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">result</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"skeleton.service.EditSkeleton\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.EditSkeleton)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tparams, validation </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> ValidateAndBuildUpdateParams</span><span style=\"color:#E1E4E8\">(claims.ID, req.</span><span style=\"color:#B392F0\">GetSkeleton</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> validation </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, fmt.</span><span style=\"color:#B392F0\">Errorf</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"validation errors: </span><span style=\"color:#79B8FF\">%w</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#E1E4E8\">, pkg.</span><span style=\"color:#B392F0\">ValidationErrors</span><span style=\"color:#E1E4E8\">(validation))</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Validation successful\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tskeleton, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">UpdateSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#F97583\">*</span><span style=\"color:#E1E4E8\">params)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Skeleton updated in store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\">skeleton, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> RemoveSkeleton</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">id</span><span style=\"color:#B392F0\"> uuid</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">UUID</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"skeleton.service.RemoveSkeleton\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.RemoveSkeleton)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">DeleteSkeleton</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">DeleteSkeletonParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tID:     id,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tUserID: claims.ID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t})</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Skeleton deleted from store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>"
  },
  {
    "id": "model_ui",
    "title": "Generated UI Page",
    "path": "app/service-client/src/routes/(app)/models/skeletons/+page.svelte",
    "lang": "svelte",
    "description": "Responsive CRUD table with loading states and error handling.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#85E89D\">script</span><span style=\"color:#B392F0\"> lang</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"ts\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { resolve } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$app/paths\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { skeleton_client } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/connect\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Skeleton } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/gen/proto/v1/skeleton_pb\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> Confirmation </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/ui/confirmation.svelte\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { toast } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/ui/toast.svelte\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { ConnectError } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"@connectrpc/connect\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    let</span><span style=\"color:#E1E4E8\"> skeletons </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> $</span><span style=\"color:#B392F0\">state</span><span style=\"color:#E1E4E8\">&#x3C;(</span><span style=\"color:#B392F0\">Skeleton</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> undefined</span><span style=\"color:#E1E4E8\">)[]>([]);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    let</span><span style=\"color:#E1E4E8\"> item_id </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> $</span><span style=\"color:#B392F0\">state</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"\"</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    (</span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        for</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> res</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> skeleton_client.</span><span style=\"color:#B392F0\">getAllSkeletons</span><span style=\"color:#E1E4E8\">({})) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            skeletons.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(res.skeleton);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    })();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> submit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">e</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> SubmitEvent</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">currentTarget</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> HTMLFormElement</span><span style=\"color:#E1E4E8\"> }) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        e.</span><span style=\"color:#B392F0\">preventDefault</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> formData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> FormData</span><span style=\"color:#E1E4E8\">(e.currentTarget);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> id</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> formData.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"id\"</span><span style=\"color:#E1E4E8\">)?.</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> modal</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> document.</span><span style=\"color:#B392F0\">getElementById</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"delete-dialog\"</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> HTMLDialogElement</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        modal?.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            await</span><span style=\"color:#E1E4E8\"> skeleton_client.</span><span style=\"color:#B392F0\">removeSkeleton</span><span style=\"color:#E1E4E8\">({ id });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            toast.</span><span style=\"color:#B392F0\">warning</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Success!\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"Skeleton deleted successfully.\"</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            skeletons </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> skeletons.</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">skeleton</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> skeleton?.id </span><span style=\"color:#F97583\">!==</span><span style=\"color:#E1E4E8\"> id);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            const</span><span style=\"color:#79B8FF\"> err</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> ConnectError.</span><span style=\"color:#B392F0\">from</span><span style=\"color:#E1E4E8\">(error);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            toast.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Error!\"</span><span style=\"color:#E1E4E8\">, err.message);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            return</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;/</span><span style=\"color:#85E89D\">script</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#85E89D\">form</span><span style=\"color:#B392F0\"> onsubmit</span><span style=\"color:#E1E4E8\">={submit}></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">input</span><span style=\"color:#B392F0\"> type</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"hidden\"</span><span style=\"color:#B392F0\"> name</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"id\"</span><span style=\"color:#B392F0\"> value</span><span style=\"color:#E1E4E8\">={item_id} /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#79B8FF\">Confirmation</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        id</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"delete-dialog\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        title</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"Delete\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        message</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"Are you sure you want to delete this item? This action cannot be undone.\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;/</span><span style=\"color:#85E89D\">form</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex flex-col items-center justify-center gap-8 p-4\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">h1</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-2xl font-bold mb-4\"</span><span style=\"color:#E1E4E8\">>Skeletons&#x3C;/</span><span style=\"color:#85E89D\">h1</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">a</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn btn-primary mb-4\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        href</span><span style=\"color:#E1E4E8\">={</span><span style=\"color:#B392F0\">resolve</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"/(app)/models/skeletons/[skeleton_id]\"</span><span style=\"color:#E1E4E8\">, { skeleton_id: </span><span style=\"color:#9ECBFF\">\"new\"</span><span style=\"color:#E1E4E8\"> })}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        Create New Skeleton</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;/</span><span style=\"color:#85E89D\">a</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"overflow-x-auto\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;</span><span style=\"color:#85E89D\">table</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"table\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;</span><span style=\"color:#85E89D\">thead</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                &#x3C;</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Name&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Age&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Death&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Zombie&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Created&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>Updated&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">th</span><span style=\"color:#B392F0\"> role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"columnheader\"</span><span style=\"color:#E1E4E8\">>&#x3C;/</span><span style=\"color:#85E89D\">th</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                &#x3C;/</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;/</span><span style=\"color:#85E89D\">thead</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;</span><span style=\"color:#85E89D\">tbody</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                {#</span><span style=\"color:#F97583\">each</span><span style=\"color:#E1E4E8\"> skeletons </span><span style=\"color:#F97583\">as</span><span style=\"color:#E1E4E8\"> skeleton, i (skeleton?.id </span><span style=\"color:#F97583\">??</span><span style=\"color:#E1E4E8\"> i)}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#F97583\"> !</span><span style=\"color:#E1E4E8\">skeleton}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#B392F0\"> colspan</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#79B8FF\">7</span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-center\"</span><span style=\"color:#E1E4E8\">> Loading... &#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;/</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    {:</span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#B392F0\"> data-testid</span><span style=\"color:#E1E4E8\">={skeleton.id}></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{skeleton.name}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{skeleton.age}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{</span><span style=\"color:#F97583\">new</span><span style=\"color:#B392F0\"> Date</span><span style=\"color:#E1E4E8\">(skeleton.death).</span><span style=\"color:#B392F0\">toLocaleDateString</span><span style=\"color:#E1E4E8\">()}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{skeleton.zombie </span><span style=\"color:#F97583\">?</span><span style=\"color:#9ECBFF\"> \"Yes\"</span><span style=\"color:#F97583\"> :</span><span style=\"color:#9ECBFF\"> \"No\"</span><span style=\"color:#E1E4E8\">}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{</span><span style=\"color:#F97583\">new</span><span style=\"color:#B392F0\"> Date</span><span style=\"color:#E1E4E8\">(skeleton.created).</span><span style=\"color:#B392F0\">toLocaleDateString</span><span style=\"color:#E1E4E8\">()}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">>{</span><span style=\"color:#F97583\">new</span><span style=\"color:#B392F0\"> Date</span><span style=\"color:#E1E4E8\">(skeleton.updated).</span><span style=\"color:#B392F0\">toLocaleDateString</span><span style=\"color:#E1E4E8\">()}&#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">td</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-right\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">a</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    href</span><span style=\"color:#E1E4E8\">={</span><span style=\"color:#B392F0\">resolve</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"/(app)/models/skeletons/[skeleton_id]\"</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        skeleton_id: skeleton.id</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    })}</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn btn-ghost btn-sm\"</span><span style=\"color:#E1E4E8\">>Edit&#x3C;/</span><span style=\"color:#85E89D\">a</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn btn-ghost btn-sm text-error\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    command</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"show-modal\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    commandfor</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"delete-dialog\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    onclick</span><span style=\"color:#E1E4E8\">={() </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        item_id </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> skeleton.id;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    }}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Delete</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">button</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;/</span><span style=\"color:#85E89D\">td</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;/</span><span style=\"color:#85E89D\">tr</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                {/</span><span style=\"color:#F97583\">each</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;/</span><span style=\"color:#85E89D\">tbody</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;/</span><span style=\"color:#85E89D\">table</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span></code></pre>"
  },
  {
    "id": "payment_service",
    "title": "Payment Service (Stripe)",
    "path": "app/service-core/domain/payment/service.go",
    "lang": "go",
    "description": "Complex integration logic with Stripe webhooks and subscription management.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">package</span><span style=\"color:#B392F0\"> payment</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> (</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">context</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">encoding/json</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">errors</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/pkg</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/pkg/auth</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tot </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">gofast/pkg/otel</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/service-core/config</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">gofast/service-core/storage/query</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">log/slog</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">time</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">github.com/stripe/stripe-go/v84</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tportal_session </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">github.com/stripe/stripe-go/v84/billingportal/session</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tcheckout_session </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">github.com/stripe/stripe-go/v84/checkout/session</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">github.com/stripe/stripe-go/v84/customer</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">github.com/stripe/stripe-go/v84/webhook</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> Deps</span><span style=\"color:#F97583\"> struct</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tCfg   </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">config</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Config</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tStore </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Queries</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> URLResponse</span><span style=\"color:#F97583\"> struct</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tURL </span><span style=\"color:#F97583\">string</span><span style=\"color:#9ECBFF\"> `json:\"url\"`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> CreatePaymentCheckout</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">plan</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">successURL</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">cancelURL</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">url</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">URLResponse</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"payment.service.CreatePaymentCheckout\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.CreateCheckout)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tuser, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">SelectUserByID</span><span style=\"color:#E1E4E8\">(ctx, claims.ID)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> user.CustomerID </span><span style=\"color:#F97583\">==</span><span style=\"color:#9ECBFF\"> \"\"</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tcustomerID, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> createCustomer</span><span style=\"color:#E1E4E8\">(ctx, d, user.Email)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tparams </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">UpdateUserCustomerIDParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tID:         user.ID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tCustomerID: customerID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">UpdateUserCustomerID</span><span style=\"color:#E1E4E8\">(ctx, params)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tuser.CustomerID </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> customerID</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tvar</span><span style=\"color:#E1E4E8\"> priceID </span><span style=\"color:#F97583\">string</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> plan </span><span style=\"color:#F97583\">==</span><span style=\"color:#9ECBFF\"> \"pro\"</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tpriceID </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripePriceIDPro</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t} </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tpriceID </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripePriceIDBasic</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tstripe.Key </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripeAPIKey</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tparams </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CheckoutSessionParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tParams: </span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Params</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tContext: ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tSuccessURL: stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(successURL),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCancelURL:  stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(cancelURL),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tPaymentMethodTypes: stripe.</span><span style=\"color:#B392F0\">StringSlice</span><span style=\"color:#E1E4E8\">([]</span><span style=\"color:#F97583\">string</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\t\t\"card\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}),</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// For subscription</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tMode: stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"subscription\"</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// For one-time payment</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// Mode: stripe.String(\"payment\"),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tLineItems: []</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CheckoutSessionLineItemParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\t{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\t\tPrice:    stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(priceID),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\t\tQuantity: stripe.</span><span style=\"color:#B392F0\">Int64</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\t},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCustomer: stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(user.CustomerID),</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// For one-time payment</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// InvoiceCreation: &#x26;stripe.CheckoutSessionInvoiceCreationParams{</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t//     Enabled: stripe.Bool(true),</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t\t// },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tAllowPromotionCodes: stripe.</span><span style=\"color:#B392F0\">Bool</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tsession, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> checkout_session.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(params)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">URLResponse</span><span style=\"color:#E1E4E8\">{URL: session.URL}, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> CreatePaymentPortal</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">returnURL</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">url</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">URLResponse</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"payment.service.CreatePaymentPortal\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tclaims, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> auth.</span><span style=\"color:#B392F0\">Authorize</span><span style=\"color:#E1E4E8\">(ctx, span, auth.CreatePortal)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">ForbiddenError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tuser, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">SelectUserByID</span><span style=\"color:#E1E4E8\">(ctx, claims.ID)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"User selected from store\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tstripe.Key </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripeAPIKey</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tparams </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">BillingPortalSessionParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tParams: </span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Params</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tContext: ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCustomer:  stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(user.CustomerID),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tReturnURL: stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(returnURL),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tsession, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> portal_session.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(params)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Portal session created\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">URLResponse</span><span style=\"color:#E1E4E8\">{URL: session.URL}, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> Webhook</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">signature</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">payload</span><span style=\"color:#E1E4E8\"> []</span><span style=\"color:#F97583\">byte</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"payment.service.Webhook\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tendpointSecret </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripeWebhookSecret</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tevent, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> webhook.</span><span style=\"color:#B392F0\">ConstructEvent</span><span style=\"color:#E1E4E8\">(payload, signature, endpointSecret)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Webhook signature verified\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tswitch</span><span style=\"color:#E1E4E8\"> event.Type {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tcase</span><span style=\"color:#E1E4E8\"> stripe.EventTypeInvoicePaid:</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> handleInvoicePaid</span><span style=\"color:#E1E4E8\">(ctx, d, event)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefault</span><span style=\"color:#E1E4E8\">:</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tslog.</span><span style=\"color:#B392F0\">Info</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Unhandled event type\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"type\"</span><span style=\"color:#E1E4E8\">, event.Type)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> handleInvoicePaid</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">event</span><span style=\"color:#B392F0\"> stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Event</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"payment.service.handleInvoicePaid\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tvar</span><span style=\"color:#E1E4E8\"> invoice </span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Invoice</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> json.</span><span style=\"color:#B392F0\">Unmarshal</span><span style=\"color:#E1E4E8\">(event.Data.Raw, </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#E1E4E8\">invoice)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#B392F0\"> len</span><span style=\"color:#E1E4E8\">(invoice.Lines.Data) </span><span style=\"color:#F97583\">==</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: errors.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"no invoice lines\"</span><span style=\"color:#E1E4E8\">)}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Invoice parsed\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Look for positive amount line item</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tvar</span><span style=\"color:#E1E4E8\"> line </span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InvoiceLineItem</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tfor</span><span style=\"color:#E1E4E8\"> _, l </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> range</span><span style=\"color:#E1E4E8\"> invoice.Lines.Data {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> l.Amount </span><span style=\"color:#F97583\">></span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tline </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> l</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\t\tbreak</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> line </span><span style=\"color:#F97583\">==</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tslog.</span><span style=\"color:#B392F0\">Info</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"No positive amount line item found\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"No positive amount line item\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Parse actual Stripe data</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tcustomerID </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> invoice.Customer.ID</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tsubscriptionID </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> line.Parent.SubscriptionItemDetails.Subscription</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tpriceID </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> line.Pricing.PriceDetails.Price</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tperiodStart </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> time.</span><span style=\"color:#B392F0\">Unix</span><span style=\"color:#E1E4E8\">(line.Period.Start, </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tperiodEnd </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> time.</span><span style=\"color:#B392F0\">Unix</span><span style=\"color:#E1E4E8\">(line.Period.End, </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">AddDate</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">, d.Cfg.SubscriptionSafePeriodDays)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> subscriptionID </span><span style=\"color:#F97583\">==</span><span style=\"color:#9ECBFF\"> \"\"</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#E1E4E8\"> priceID </span><span style=\"color:#F97583\">==</span><span style=\"color:#9ECBFF\"> \"\"</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: errors.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"subscription ID or price ID is empty\"</span><span style=\"color:#E1E4E8\">)}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tuser, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">SelectUserByCustomerID</span><span style=\"color:#E1E4E8\">(ctx, customerID)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"User selected by customer ID\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t_, err </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Store.</span><span style=\"color:#B392F0\">UpsertSubscription</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">UpsertSubscriptionParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tUserID:               user.ID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tStripeCustomerID:     customerID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tStripeSubscriptionID: subscriptionID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tStripePriceID:        priceID,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tStatus:               </span><span style=\"color:#9ECBFF\">\"active\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCurrentPeriodStart:   periodStart,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tCurrentPeriodEnd:     periodEnd,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t})</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#B392F0\"> pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Subscription upserted\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tslog.</span><span style=\"color:#B392F0\">Info</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Subscription upserted\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"customerID\"</span><span style=\"color:#E1E4E8\">, customerID, </span><span style=\"color:#9ECBFF\">\"subscriptionID\"</span><span style=\"color:#E1E4E8\">, subscriptionID, </span><span style=\"color:#9ECBFF\">\"priceID\"</span><span style=\"color:#E1E4E8\">, priceID, </span><span style=\"color:#9ECBFF\">\"periodEnd\"</span><span style=\"color:#E1E4E8\">, periodEnd)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> createCustomer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">d</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">Deps</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">userEmail</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#FFAB70\">customerID</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, span, done </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> ot.</span><span style=\"color:#B392F0\">StartSpan</span><span style=\"color:#E1E4E8\">(ctx, </span><span style=\"color:#9ECBFF\">\"payment.service.createCustomer\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tdefer</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">() { </span><span style=\"color:#B392F0\">done</span><span style=\"color:#E1E4E8\">(err) }()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tstripe.Key </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> d.Cfg.StripeAPIKey</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tparams </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">CustomerParams</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tParams: </span><span style=\"color:#B392F0\">stripe</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Params</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tContext: ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tEmail: stripe.</span><span style=\"color:#B392F0\">String</span><span style=\"color:#E1E4E8\">(userEmail),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tc, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> customer.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(params)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#9ECBFF\"> \"\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">pkg</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">InternalError</span><span style=\"color:#E1E4E8\">{Err: err}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan.</span><span style=\"color:#B392F0\">AddEvent</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Customer created in Stripe\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> c.ID, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>"
  },
  {
    "id": "payment_ui",
    "title": "Payment UI",
    "path": "app/service-client/src/routes/(app)/payments/+page.svelte",
    "lang": "svelte",
    "description": "Subscription management UI with dynamic plan selection.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#85E89D\">script</span><span style=\"color:#B392F0\"> lang</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"ts\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { store, BASIC_PLAN, PRO_PLAN, checkSubscription } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/store.svelte\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { payment_client } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/connect\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { toast } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"$lib/ui/toast.svelte\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    import</span><span style=\"color:#E1E4E8\"> { ConnectError } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> \"@connectrpc/connect\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Derive current plan from access bits</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    let</span><span style=\"color:#E1E4E8\"> currentPlan </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> $derived.</span><span style=\"color:#B392F0\">by</span><span style=\"color:#E1E4E8\">(() </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (store.user.access </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#79B8FF\"> PRO_PLAN</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">return</span><span style=\"color:#9ECBFF\"> \"pro\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (store.user.access </span><span style=\"color:#F97583\">&#x26;</span><span style=\"color:#79B8FF\"> BASIC_PLAN</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">return</span><span style=\"color:#9ECBFF\"> \"basic\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    let</span><span style=\"color:#E1E4E8\"> hasSubscription </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> $</span><span style=\"color:#B392F0\">derived</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">checkSubscription</span><span style=\"color:#E1E4E8\">(store.user.access));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> submit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">e</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> SubmitEvent</span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">currentTarget</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> HTMLFormElement</span><span style=\"color:#E1E4E8\"> }) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        e.</span><span style=\"color:#B392F0\">preventDefault</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> formData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> FormData</span><span style=\"color:#E1E4E8\">(e.currentTarget);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        const</span><span style=\"color:#79B8FF\"> plan</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> formData.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"plan\"</span><span style=\"color:#E1E4E8\">)?.</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            const</span><span style=\"color:#79B8FF\"> r</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> payment_client.</span><span style=\"color:#B392F0\">createCheckoutSession</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                plan: plan,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                successUrl: </span><span style=\"color:#9ECBFF\">`${</span><span style=\"color:#E1E4E8\">window</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">location</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">origin</span><span style=\"color:#9ECBFF\">}/payments?success=true`</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                cancelUrl: </span><span style=\"color:#9ECBFF\">`${</span><span style=\"color:#E1E4E8\">window</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">location</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">origin</span><span style=\"color:#9ECBFF\">}/payments?cancel=true`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">r.url) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                toast.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Error!\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"No URL returned from server.\"</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                return</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            window.location.href </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> r.url;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            const</span><span style=\"color:#79B8FF\"> err</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> ConnectError.</span><span style=\"color:#B392F0\">from</span><span style=\"color:#E1E4E8\">(error);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            toast.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Error!\"</span><span style=\"color:#E1E4E8\">, err.message);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            return</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> openPortal</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            const</span><span style=\"color:#79B8FF\"> r</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> payment_client.</span><span style=\"color:#B392F0\">createPortalSession</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                returnUrl: </span><span style=\"color:#9ECBFF\">`${</span><span style=\"color:#E1E4E8\">window</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">location</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">origin</span><span style=\"color:#9ECBFF\">}/payments`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">r.url) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                toast.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Error!\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"No URL returned from server.\"</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                return</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            window.location.href </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> r.url;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            const</span><span style=\"color:#79B8FF\"> err</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> ConnectError.</span><span style=\"color:#B392F0\">from</span><span style=\"color:#E1E4E8\">(error);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            toast.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"Error!\"</span><span style=\"color:#E1E4E8\">, err.message);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">            return</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    function</span><span style=\"color:#B392F0\"> getButtonText</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">plan</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> \"basic\"</span><span style=\"color:#F97583\"> |</span><span style=\"color:#9ECBFF\"> \"pro\"</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (currentPlan </span><span style=\"color:#F97583\">===</span><span style=\"color:#E1E4E8\"> plan) </span><span style=\"color:#F97583\">return</span><span style=\"color:#9ECBFF\"> \"Manage\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (plan </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> \"pro\"</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">return</span><span style=\"color:#9ECBFF\"> \"Upgrade\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#9ECBFF\"> \"Downgrade\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;/</span><span style=\"color:#85E89D\">script</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex flex-col items-center justify-center gap-8 p-4\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">h1</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-2xl font-bold mb-4\"</span><span style=\"color:#E1E4E8\">>Payments&#x3C;/</span><span style=\"color:#85E89D\">h1</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> hasSubscription}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;</span><span style=\"color:#85E89D\">p</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-center text-base-content/70\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            You are currently on the &#x3C;</span><span style=\"color:#85E89D\">span</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"font-semibold text-primary\"</span><span style=\"color:#E1E4E8\">>{currentPlan}&#x3C;/</span><span style=\"color:#85E89D\">span</span><span style=\"color:#E1E4E8\">> plan.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;/</span><span style=\"color:#85E89D\">p</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {:</span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;</span><span style=\"color:#85E89D\">p</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-center text-base-content/70\"</span><span style=\"color:#E1E4E8\">>Choose a plan to get started.&#x3C;/</span><span style=\"color:#85E89D\">p</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"isolate overflow-hidden p-4\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flow-root pb-24 sm:pb-32\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mx-auto max-w-7xl px-6 lg:px-8\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mx-auto grid max-w-md grid-cols-1 gap-8 lg:max-w-4xl lg:grid-cols-2\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">form</span><span style=\"color:#B392F0\"> onsubmit</span><span style=\"color:#E1E4E8\">={submit} </span><span style=\"color:#B392F0\">class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">input</span><span style=\"color:#B392F0\"> type</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"hidden\"</span><span style=\"color:#B392F0\"> name</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"plan\"</span><span style=\"color:#B392F0\"> value</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"basic\"</span><span style=\"color:#E1E4E8\"> /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">div</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"relative flex flex-col justify-between rounded-3xl bg-base-200 p-8 sm:p-10 {</span><span style=\"color:#E1E4E8\">currentPlan</span><span style=\"color:#F97583\"> ===</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">                            'basic'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                ?</span><span style=\"color:#9ECBFF\"> 'ring-2 ring-primary'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                :</span><span style=\"color:#9ECBFF\"> 'outline-1 -outline-offset-1 outline-base-content/10'}\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> currentPlan </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> \"basic\"</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"absolute -top-3 left-1/2 -translate-x-1/2\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"badge badge-primary\"</span><span style=\"color:#E1E4E8\">>Current Plan&#x3C;/</span><span style=\"color:#85E89D\">span</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">h3</span><span style=\"color:#B392F0\"> id</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-hobby\"</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-base/7 font-semibold text-primary\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Basic</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">h3</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-4 flex items-baseline gap-x-2\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                        class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-5xl font-semibold tracking-tight text-base-content\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        >$1&#x3C;/</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-base/7 font-semibold text-base-content/60\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        >/month&#x3C;/</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">p</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-6 text-base/7 text-base-content/70\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Modi dolorem expedita deleniti. Corporis iste qui inventore</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    pariatur adipisci vitae.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">p</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">ul</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"list\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-10 space-y-4 text-sm/6 text-base-content/70\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        5 products</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Up to 1,000 subscribers</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Basic analytics</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        48-hour support response time</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">ul</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> hasSubscription}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    type</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"button\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    onclick</span><span style=\"color:#E1E4E8\">={openPortal}</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn mt-6 {</span><span style=\"color:#E1E4E8\">currentPlan</span><span style=\"color:#F97583\"> ===</span><span style=\"color:#9ECBFF\"> 'basic'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                        ?</span><span style=\"color:#9ECBFF\"> 'btn-outline btn-primary'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                        :</span><span style=\"color:#9ECBFF\"> 'btn-primary'}\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    aria-describedby</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-hobby\"</span><span style=\"color:#E1E4E8\">>{</span><span style=\"color:#B392F0\">getButtonText</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"basic\"</span><span style=\"color:#E1E4E8\">)}&#x3C;/</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {:</span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">button</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn mt-6 btn-primary\"</span><span style=\"color:#B392F0\"> aria-describedby</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-hobby\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    >Get started&#x3C;/</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;/</span><span style=\"color:#85E89D\">form</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;</span><span style=\"color:#85E89D\">form</span><span style=\"color:#B392F0\"> onsubmit</span><span style=\"color:#E1E4E8\">={submit} </span><span style=\"color:#B392F0\">class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">input</span><span style=\"color:#B392F0\"> type</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"hidden\"</span><span style=\"color:#B392F0\"> name</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"plan\"</span><span style=\"color:#B392F0\"> value</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"pro\"</span><span style=\"color:#E1E4E8\"> /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;</span><span style=\"color:#85E89D\">div</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"relative flex flex-col justify-between rounded-3xl bg-base-200 p-8 sm:p-10 {</span><span style=\"color:#E1E4E8\">currentPlan</span><span style=\"color:#F97583\"> ===</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">                            'pro'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                ?</span><span style=\"color:#9ECBFF\"> 'ring-2 ring-primary'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                :</span><span style=\"color:#9ECBFF\"> 'outline-1 -outline-offset-1 outline-base-content/10'}\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> currentPlan </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> \"pro\"</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"absolute -top-3 left-1/2 -translate-x-1/2\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"badge badge-primary\"</span><span style=\"color:#E1E4E8\">>Current Plan&#x3C;/</span><span style=\"color:#85E89D\">span</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">h3</span><span style=\"color:#B392F0\"> id</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-team\"</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-base/7 font-semibold text-primary\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Pro</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">h3</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">div</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-4 flex items-baseline gap-x-2\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                        class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-5xl font-semibold tracking-tight text-base-content\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        >$2&#x3C;/</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">span</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"text-base/7 font-semibold text-base-content/60\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        >/month&#x3C;/</span><span style=\"color:#85E89D\">span</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">p</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-6 text-base/7 text-base-content/70\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Explicabo quo fugit vel facere ullam corrupti non dolores.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    Expedita eius sit sequi.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">p</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">ul</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    role</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"list\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"mt-10 space-y-4 text-sm/6 text-base-content/70\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Unlimited products</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Unlimited subscribers</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Advanced analytics</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        1-hour, dedicated support response time</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;</span><span style=\"color:#85E89D\">li</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"flex gap-x-3\"</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;</span><span style=\"color:#85E89D\">svg</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            viewBox</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"0 0 20 20\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            fill</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"currentColor\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            data-slot</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"icon\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            aria-hidden</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"true\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                            class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"h-6 w-5 flex-none text-primary\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            &#x3C;</span><span style=\"color:#85E89D\">path</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                d</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                clip-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                                fill-rule</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"evenodd\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                            /></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        &#x3C;/</span><span style=\"color:#85E89D\">svg</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                        Marketing automations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    &#x3C;/</span><span style=\"color:#85E89D\">li</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;/</span><span style=\"color:#85E89D\">ul</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {#</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> hasSubscription}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    type</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"button\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    onclick</span><span style=\"color:#E1E4E8\">={openPortal}</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn mt-6 {</span><span style=\"color:#E1E4E8\">currentPlan</span><span style=\"color:#F97583\"> ===</span><span style=\"color:#9ECBFF\"> 'pro'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                        ?</span><span style=\"color:#9ECBFF\"> 'btn-outline btn-primary'</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">                                        :</span><span style=\"color:#9ECBFF\"> 'btn-primary'}\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">                                    aria-describedby</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-team\"</span><span style=\"color:#E1E4E8\">>{</span><span style=\"color:#B392F0\">getButtonText</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"pro\"</span><span style=\"color:#E1E4E8\">)}&#x3C;/</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {:</span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                &#x3C;</span><span style=\"color:#85E89D\">button</span><span style=\"color:#B392F0\"> class</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"btn mt-6 btn-primary\"</span><span style=\"color:#B392F0\"> aria-describedby</span><span style=\"color:#E1E4E8\">=</span><span style=\"color:#9ECBFF\">\"tier-team\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                    >Get started&#x3C;/</span><span style=\"color:#85E89D\">button</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                                ></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                            {/</span><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                        &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                    &#x3C;/</span><span style=\"color:#85E89D\">form</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">                &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#x3C;/</span><span style=\"color:#85E89D\">div</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"></span></code></pre>"
  },
  {
    "id": "otel",
    "title": "OpenTelemetry Setup",
    "path": "app/pkg/otel/otel.go",
    "lang": "go",
    "description": "Production-ready observability configuration for Traces, Metrics, and Logs.",
    "html": "<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">package</span><span style=\"color:#B392F0\"> otel</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> (</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">context</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">errors</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">time</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/attribute</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/codes</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/exporters/otlp/otlplog/otlploggrpc</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/exporters/otlp/otlpmetric/otlpmetricgrpc</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/log/global</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/propagation</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/sdk/log</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/sdk/metric</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/sdk/resource</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">\t\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/sdk/trace</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tsemconv </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/semconv/v1.26.0</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tspan </span><span style=\"color:#9ECBFF\">\"</span><span style=\"color:#B392F0\">go.opentelemetry.io/otel/trace</span><span style=\"color:#9ECBFF\">\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// StartSpan starts a new span and returns a cleanup function that handles</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// error recording and status setting. Use with named return values:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//\tfunc Foo(ctx context.Context) (result T, err error) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//\t    ctx, span, done := ot.StartSpan(ctx, \"operation.name\")</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//\t    defer func() { done(err) }()</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//\t    // ... your logic</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">//\t}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> StartSpan</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#B392F0\">context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">span</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Span</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">)) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tctx, s </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> otel.</span><span style=\"color:#B392F0\">Tracer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"gofast\"</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">Start</span><span style=\"color:#E1E4E8\">(ctx, name)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> ctx, s, </span><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\ts.</span><span style=\"color:#B392F0\">RecordError</span><span style=\"color:#E1E4E8\">(err)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\ts.</span><span style=\"color:#B392F0\">SetStatus</span><span style=\"color:#E1E4E8\">(codes.Error, err.</span><span style=\"color:#B392F0\">Error</span><span style=\"color:#E1E4E8\">())</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t} </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\ts.</span><span style=\"color:#B392F0\">SetStatus</span><span style=\"color:#E1E4E8\">(codes.Ok, </span><span style=\"color:#9ECBFF\">\"\"</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\ts.</span><span style=\"color:#B392F0\">End</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> SetupOTelSDK</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">endpoint</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">serviceName</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// If no endpoint is configured, disable OTel completely</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> endpoint </span><span style=\"color:#F97583\">==</span><span style=\"color:#9ECBFF\"> \"\"</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#F97583\">return</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tvar</span><span style=\"color:#E1E4E8\"> shutdownFuncs []</span><span style=\"color:#F97583\">func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tvar</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">error</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tshutdown </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tvar</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">error</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\tfor</span><span style=\"color:#E1E4E8\"> _, fn </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> range</span><span style=\"color:#E1E4E8\"> shutdownFuncs {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> errors.</span><span style=\"color:#B392F0\">Join</span><span style=\"color:#E1E4E8\">(err, </span><span style=\"color:#B392F0\">fn</span><span style=\"color:#E1E4E8\">(ctx))</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tshutdownFuncs </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> nil</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\thandleErr </span><span style=\"color:#F97583\">:=</span><span style=\"color:#F97583\"> func</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">inErr</span><span style=\"color:#F97583\"> error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\terr </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> errors.</span><span style=\"color:#B392F0\">Join</span><span style=\"color:#E1E4E8\">(inErr, </span><span style=\"color:#B392F0\">shutdown</span><span style=\"color:#E1E4E8\">(ctx))</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Set up propagator.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tprop </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> newPropagator</span><span style=\"color:#E1E4E8\">()</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\totel.</span><span style=\"color:#B392F0\">SetTextMapPropagator</span><span style=\"color:#E1E4E8\">(prop)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Set up resource describing this service.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tres, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> newResource</span><span style=\"color:#E1E4E8\">(ctx, serviceName)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\thandleErr</span><span style=\"color:#E1E4E8\">(err)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> shutdown, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Set up trace provider.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\ttracerProvider, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> newTracerProvider</span><span style=\"color:#E1E4E8\">(ctx, res, endpoint)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\thandleErr</span><span style=\"color:#E1E4E8\">(err)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> shutdown, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tshutdownFuncs </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> append</span><span style=\"color:#E1E4E8\">(shutdownFuncs, tracerProvider.Shutdown)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\totel.</span><span style=\"color:#B392F0\">SetTracerProvider</span><span style=\"color:#E1E4E8\">(tracerProvider)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Set up meter provider.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tmeterProvider, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> newMeterProvider</span><span style=\"color:#E1E4E8\">(ctx, res, endpoint)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\thandleErr</span><span style=\"color:#E1E4E8\">(err)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> shutdown, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tshutdownFuncs </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> append</span><span style=\"color:#E1E4E8\">(shutdownFuncs, meterProvider.Shutdown)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\totel.</span><span style=\"color:#B392F0\">SetMeterProvider</span><span style=\"color:#E1E4E8\">(meterProvider)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">\t// Set up logger provider.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tloggerProvider, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#B392F0\"> newLoggerProvider</span><span style=\"color:#E1E4E8\">(ctx, res, endpoint)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\thandleErr</span><span style=\"color:#E1E4E8\">(err)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#E1E4E8\"> shutdown, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tshutdownFuncs </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> append</span><span style=\"color:#E1E4E8\">(shutdownFuncs, loggerProvider.Shutdown)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tglobal.</span><span style=\"color:#B392F0\">SetLoggerProvider</span><span style=\"color:#E1E4E8\">(loggerProvider)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> shutdown, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> newPropagator</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#B392F0\">propagation</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">TextMapPropagator</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> propagation.</span><span style=\"color:#B392F0\">NewCompositeTextMapPropagator</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\tpropagation</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">TraceContext</span><span style=\"color:#E1E4E8\">{},</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">\t\tpropagation</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Baggage</span><span style=\"color:#E1E4E8\">{},</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> newResource</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">serviceName</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">resource</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Resource</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tattrs </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> []</span><span style=\"color:#B392F0\">attribute</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">KeyValue</span><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tsemconv.</span><span style=\"color:#B392F0\">ServiceName</span><span style=\"color:#E1E4E8\">(serviceName),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> resource.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tresource.</span><span style=\"color:#B392F0\">WithFromEnv</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tresource.</span><span style=\"color:#B392F0\">WithTelemetrySDK</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tresource.</span><span style=\"color:#B392F0\">WithProcess</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tresource.</span><span style=\"color:#B392F0\">WithHost</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tresource.</span><span style=\"color:#B392F0\">WithAttributes</span><span style=\"color:#E1E4E8\">(attrs</span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> newTracerProvider</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">res</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">resource</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Resource</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">endpoint</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">trace</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">TracerProvider</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\ttraceExporter, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> otlptracegrpc.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlptracegrpc.</span><span style=\"color:#B392F0\">WithInsecure</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlptracegrpc.</span><span style=\"color:#B392F0\">WithEndpoint</span><span style=\"color:#E1E4E8\">(endpoint),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\ttracerProvider </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> trace.</span><span style=\"color:#B392F0\">NewTracerProvider</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\ttrace.</span><span style=\"color:#B392F0\">WithBatcher</span><span style=\"color:#E1E4E8\">(traceExporter,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\ttrace.</span><span style=\"color:#B392F0\">WithBatchTimeout</span><span style=\"color:#E1E4E8\">(time.Second)),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\ttrace.</span><span style=\"color:#B392F0\">WithResource</span><span style=\"color:#E1E4E8\">(res),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> tracerProvider, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> newMeterProvider</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">res</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">resource</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Resource</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">endpoint</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">metric</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">MeterProvider</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tmetricExporter, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> otlpmetricgrpc.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlpmetricgrpc.</span><span style=\"color:#B392F0\">WithInsecure</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlpmetricgrpc.</span><span style=\"color:#B392F0\">WithEndpoint</span><span style=\"color:#E1E4E8\">(endpoint),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tmeterProvider </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> metric.</span><span style=\"color:#B392F0\">NewMeterProvider</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tmetric.</span><span style=\"color:#B392F0\">WithReader</span><span style=\"color:#E1E4E8\">(metric.</span><span style=\"color:#B392F0\">NewPeriodicReader</span><span style=\"color:#E1E4E8\">(metricExporter,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\t\tmetric.</span><span style=\"color:#B392F0\">WithInterval</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">3</span><span style=\"color:#F97583\">*</span><span style=\"color:#E1E4E8\">time.Second))),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tmetric.</span><span style=\"color:#B392F0\">WithResource</span><span style=\"color:#E1E4E8\">(res),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> meterProvider, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">func</span><span style=\"color:#B392F0\"> newLoggerProvider</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">ctx</span><span style=\"color:#B392F0\"> context</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Context</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">res</span><span style=\"color:#F97583\"> *</span><span style=\"color:#B392F0\">resource</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">Resource</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">endpoint</span><span style=\"color:#F97583\"> string</span><span style=\"color:#E1E4E8\">) (</span><span style=\"color:#F97583\">*</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">LoggerProvider</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">error</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tlogExporter, err </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> otlploggrpc.</span><span style=\"color:#B392F0\">New</span><span style=\"color:#E1E4E8\">(ctx,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlploggrpc.</span><span style=\"color:#B392F0\">WithInsecure</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\totlploggrpc.</span><span style=\"color:#B392F0\">WithEndpoint</span><span style=\"color:#E1E4E8\">(endpoint),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\tif</span><span style=\"color:#E1E4E8\"> err </span><span style=\"color:#F97583\">!=</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\t\treturn</span><span style=\"color:#79B8FF\"> nil</span><span style=\"color:#E1E4E8\">, err</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\tloggerProvider </span><span style=\"color:#F97583\">:=</span><span style=\"color:#E1E4E8\"> log.</span><span style=\"color:#B392F0\">NewLoggerProvider</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tlog.</span><span style=\"color:#B392F0\">WithProcessor</span><span style=\"color:#E1E4E8\">(log.</span><span style=\"color:#B392F0\">NewBatchProcessor</span><span style=\"color:#E1E4E8\">(logExporter)),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t\tlog.</span><span style=\"color:#B392F0\">WithResource</span><span style=\"color:#E1E4E8\">(res),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">\t)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">\treturn</span><span style=\"color:#E1E4E8\"> loggerProvider, </span><span style=\"color:#79B8FF\">nil</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>"
  }
]